Created at:  2025-01-14 23:04
Tag: #web 
References:
- https://en.wikipedia.org/wiki/Webhook
- https://docs.tosspayments.com/resources/glossary/webhook
Link Notes:

# Webhook 이란
위키피디아에 따르면, 웹훅은 웹이나 웹앱에서 발생하는 특정 행동(이벤트)들을 커스텀 Callback으로 변환해주는 방법이다. 조금 더 풀어서 설명하면, 일반적인 API는 클라이언트가 서버를 호출하는 방식인데, 웹훅의 경우에는 서버에서 특정 이벤트가 발생했을 때 클라이언트를 호출하는 방식.

**callback URL**은 서버측에서 이벤트가 발생했을 때 클라이언트의 어느 URL로 데이터를 보낼지 미리 정해놓은 주소이다.
# Webhook을 사용하는 이유
다음과 같은 상황을 생각해봅시다: 
메일을 수신할 수 있는 웹앱의 클라이언트와 서버가 있다. 구현할 것은 서버측에서 메일을 수신하였을 경우 클라이언트 측으로 알림 메시지를 전달하는 것이다.

**일반적인 API**로 구현(Polling)한다면 다음과 같은 순서로 진행된다.
1. [클라이언트 → 서버] 메일이 수신 되었나?
    - 수신하지 못한 경우라면: 1번으로 돌아갑니다.
    - 수신한 경우라면: 2번으로 갑니다.
2. 메일에 대한 정보를 받아옵니다.
3. 클라이언트에서 해당 메일 정보를 파싱해 화면에 출력합니다.

하지만 **웹훅을 사용한다면** 다음과 같은 간략한 순서로 진행할 수 있다.
1. 메일이 수신되었을 경우: [서버 → 클라이언트] 미리 지정한 클라이언트의 callback URL로 메일에 대한 정보를 보냄(보통 HTTP POST를 통해 요청을 보냄)
2. 클라이언트에서 해당 메일 정보를 파싱해 화면에 출력

첫 번째 방법은 클라이언트 측에서 서버쪽으로 지속적으로 수신되었는지 계속해서 여부를 확인한다. 그에 반해, 웹훅의 방법은 그냥 서버에서 이벤트가 발생했을 때 바로 클라이언트로 정보를 전달해주므로 클라이언트에서는 해당 이벤트에 대한 핸들러로 처리해주기만 하면 된다.

즉, 절대적인 API 요청 횟수가 적어지기 때문에 웹훅을 사용하는게 훨씬 더 효율적.

다음 폴링과 웹훅 방식을 비교한 그림 자료를 참고 하십시오.
![polling vs webhooks](https://dz2cdn1.dzone.com/storage/temp/5679141-screen-shot-2017-06-21-at-43750-pm.png)
# Webhook 구현 시 유의할 점
- 만약 어떠한 이유에 의해 웹앱이 중단되었을 경우 웹훅으로부터 오는 데이터는 유실될 가능성이 존재.
- 웹훅으로부터 오는 요청에 대하여 처리를 완료했어도 response를 제대로 하지 않으면 웹훅 측에서 response가 실패라고 판단하고 동일한 정보를 다시 보낼 가능성도 있다.
따라서 이러한 문제점들에 대해 잘 생각하고 예외처리를 잘 해야함.
