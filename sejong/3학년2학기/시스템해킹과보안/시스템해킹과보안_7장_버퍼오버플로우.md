# 1. Buffer overflow
- 버퍼에 **정해진 일정한 크기 이상**의 **데이터를 입력**해 프로그램을 공격
- **Segmentation fault** 오류
	- 프로그램의 **ret 주소를 변조**하면 해당 오류 발생.
	 -> **ret 주소의 위치**를 **역으로 확인** 가능
## 1.1 Stack Buffer overflow
- **입력 값을 확인하지 않는** 입력 함수에 정상적인 크기보다 큰 입력 값을 입력하여 **ret 값을 덮어씌워서** 임의의 **코드를 실행**하는 공격.
- ex) root소유자인 setuid가 설정된 취약 파일에서 ret을 셸 코드의 주소를 덮어씌워서 root 권한의 셸을 획득할 수 있다. 
## 1.2 Heap(BSS) Buffer overflow
- 힙에 저장되는 데이터를 변조하거나 함수에 대한 포인터 값을  변조함으로써 ret 값을 덮어씌워서 임의의 코드를 실행하는 공격.
# 2. Buffer overflow 보안
## 2.1 Buffer overflow 취약 함수
```c
strcpy getwd fscanf
strcat gets  scanf
realpath
sprintf
```
## 2.2 Non-Execution Stack
- 스택에서 **x 권한을 제거**함으로써 스택에 로드된 공격자의 **공격 코드를 실행하지 못하게** 방지하는 기술
### 2.2.1 rtl(return to libc)
- 스택에 있는 ret 주소를 실행 가능한 **libc 영역의 주소**로 돌려 원하는 함수를 수행되게 하려는 기법.
![[Pasted image 20251015002223.png|400]]
## 2.3 Stack Guard
- 컴파일러가 canary 주입/검사 코드를 넣어서 ret 주소 변조를 확인함.
- 함수 호출(프롤로그) -> **ret 앞에 canary 값을 주입** 
- 함수 종료(return: 에필로그) -> **canary 값을 변조했는지 확인**하여 변조 시 프로그램 종료
### 2.3.1 Stack Guard의 기술들
- **Random canary**: 프로그램을 실행할 때마다 canary 값을 바꿔서 이전에 실행해 얻은 canary 값을 활용하지 못하게 막는다.
- **Null canary**: 버퍼 오버플로우 공격 시 Null 문자열은 해당 값의 종료를 의미함. Null은 절대로 넣을 수 없다는 것을 이용해 canary에 **문자열 (0x00000000)**을 넣는다.
- **Terminator canary**: 대부분 문자열 함수의 동작은 Null에 끝나지만, Null에서 끝나지 않는 경우도 있다. 따라서 **Null, CR, LF, -1** 등을 조합하여 사용
## 2.4 Stack Shield
- 함수를 호출 -> ret을 Global RET Stack 이라는 특수 스택에 저장 
- 함수를 종료 -> if (**Global RET Stack에 저장된 ret 값** != **스택의 ret 값**) **프로그램을 종료**
## 2.5 ASLR(Address Space Layout Randomize)
- 메모리 공격을 방어 위해, **주소 공간 배치 난수화**. 스택, 힙, 라이브러리, 데이터 영역 주소 등 난수화 
# 3. 부록
## 3.1 gdb의 주요 명령

| 명령            | 가눙                                      |
| ------------- | --------------------------------------- |
| l(ist)        | 프로그램 소스 코드를 출력                          |
| b(reak)       | 브레이크 포인트 설정                             |
| disass        | 프로그램의 특정 함수에 대한 어셈블리 코드 출력              |
| r(un)         | 프로그램 실행                                 |
| print [변수]    | 변수 값 출력                                 |
| info reg      | 레지스터에 저장된 값 출력                          |
| x/16xw [주소 값] | 해당 주소 값에 해당하는 메모리 값을 출력한다.              |
| s(tep)        | 한 행씩 실행, 함수를 포함시 함수 내부로 이동하여 실행함        |
| n(ext)        | 한 행씩 실행, 함수를 포함시 함수를 완전히 실행하고 다음 행으로 이동 |
| c(ontinue)    | 프로그램의 끝 or 브레이크 포인트까지 실행                |
