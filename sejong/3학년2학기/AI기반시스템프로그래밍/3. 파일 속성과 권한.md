# 1. `stat` 함수 계열 및 파일 타입
## `stat` 함수 계열
`stat` 계열 함수는 파일의 **메타데이터**(크기, 타입, 권한, UID/GID, 시간 정보 등)를 가져오는 핵심 도구입니다.

| **함수**                            | **대상**           | **심볼릭 링크 처리**            |
| --------------------------------- | ---------------- | ------------------------ |
| `stat(path, buf)`                 | 경로에 지정된 파일       | 링크를 **따라가서** 실제 파일 정보 리턴 |
| `lstat(path, buf)`                | 경로에 지정된 파일       | **링크 자체의 정보** 리턴         |
| `fstat(fd, buf)`                  | 열린 파일 디스크립터      | FD가 가리키는 파일 정보 리턴        |
| `fstatat(dirfd, path, buf, flag)` | `dirfd` 기준 상대 경로 | `flag`에 따라 처리            |
## 파일 타입 감지 (`st_mode`)
- `struct stat` 구조체의 `st_mode` 필드는 파일의 권한과 타입을 모두 포함합니다. 
	- 하위 9비트가 권한, 상위가 타입
- POSIX 매크로를 사용하여 파일 타입을 확인할 수 있습니다.

| **매크로**             | **파일 타입**                          | **ls -l 출력 문자** |
| ------------------- | ---------------------------------- | --------------- |
| `S_ISREG(st_mode)`  | 정규 파일 (Regular)                    | `-`             |
| `S_ISDIR(st_mode)`  | 디렉터리 (Directory)                   | `d`             |
| `S_ISLNK(st_mode)`  | 심볼릭 링크 (Symbolic Link)             | `l`             |
| `S_ISCHR(st_mode)`  | 문자 디바이스 (Character Device) ex) 터미널 | `c`             |
| `S_ISBLK(st_mode)`  | 블록 디바이스 (Block Device) ex) 디스크     | `b`             |
| `S_ISFIFO(st_mode)` | FIFO (Named Pipe)                  | `p`             |
| `S_ISSOCK(st_mode)` | 소켓 (Socket)                        | `s`             |
# 2. 권한 및 소유권 (Permissions & Ownership)
## 접근 권한 (rwx)
파일 권한은 소유자(User), 소유 그룹(Group), 기타 사용자(Other)로 나뉘며, 각각 읽기(r=4), 쓰기(w=2), 실행(x=1) 권한을 가집니다.

| **마스크**                         | **의미**                |
| ------------------------------- | --------------------- |
| `S_IRUSR`, `S_IWUSR`, `S_IXUSR` | 소유자 (User) 읽기, 쓰기, 실행 |
| `S_IRGRP`, `S_IWGRP`, `S_IXGRP` | 그룹 (Group) 읽기, 쓰기, 실행 |
| `S_IROTH`, `S_IWOTH`, `S_IXOTH` | 기타 (Other) 읽기, 쓰기, 실행 |
## 소유권
- 프로세스별로 연관되는 UID/GID

| ID                      | 설명                     |
| ----------------------- | ---------------------- |
| RUID                    | 실제 UID                 |
| RGID                    | 실제 GID                 |
| EUID                    | 파일 접근 권한 검사 시 사용되는 UID |
| EGID                    | 파일 접근 권한 검사 시 사용되는 GID |
| Supplementary Group IDs | 사용자가 속한 추가 그룹 ID       |
| Saved SetUID            | `exec` 호출시 보관되는 UID    |
| Saved SetGID            | `exec` 호출시 보관되는 GID    |

## Set-User-ID (SUID) 및 Set-Group-ID (SGID)
프로세스 실행 시 권한을 일시적으로 상승시키는 특수 권한 비트입니다.
- **SUID 비트**: 실행 파일의 **소유자 UID**로 프로세스가 동작합니다.
    - `ls -l`에서 소유자 실행 비트 자리에 `s`로 표시됩니다 (`-rwsr-xr-x`).
    - **목적**: 일반 사용자가 `/etc/shadow` 파일을 수정해야 하는 `passwd` 명령처럼, 특정 프로그램 실행 시 **일시적인 루트 권한 상승**이 필요할 때 사용됩니다.
    - `exec()` 호출 시 프로세스의 EUID가 파일 소유자의 UID로 설정됩니다.
- **SGID 비트**: 실행 파일의 소유자 GID로 프로세스가 동작합니다.
- `chmod u+s` `chmod g+s`
## 새 파일/디렉터리 생성 시 소유자 설정
- UID: 새 파일/디렉터리의 UID는 생성한 프로세스의 EUID로 설정됨
- GID
	- System V 전통 방식: 생성한 프로세스의 EGID로 설정됨
	- BSD / 현대 Linux: 상위 디렉터리의 GID 상속
- **디렉터리 set-GID**: 디렉터리에 SGID가 설정되면, 그 안에서 생성되는 파일/디렉터리는 **부모 디렉터리의 GID**를 상속받습니다. (협업 환경에 유용)
## `umask()`
새 파일 또는 디렉터리 생성 시 **자동으로 제한할 권한 비트**를 설정하는 마스크입니다.
- `실제 권한 = 요청한 권한 & ~umask`.
- 예) `umask`가 `022`이면, `0666` 요청 시 `0644`가 설정됩니다.
## 접근 권한 변경 함수
파일의 권한을 변경하려면 **프로세스의 EUID**가 파일의 UID와 같거나 root 권한을 가져야함.
- `chmod(pathname, mode)`: 경로 기반 파일 권한 변경
- `fchmod(fd, mode)`
- `fchmodat(dirfd, pathname, mode, flags)`
	- `flags`가 `AT_SYMLINK_NOFOLLOW`라면 링크자체에 적용
## 소유권 변경 함수
- `chown(pathname, owner, group)`: 경로 기반으로 소유자(UID)와 그룹(GID)을 변경합니다.
	- 경로가 심볼릭 링크인 경우, **링크 가리키는 파일의 소유자/그룹**을 변경
- `lchown(pathname, owner, group)`: 경로가 심볼릭 링크인 경우, **링크 자체의 소유자/그룹**을 변경합니다.
- `fchown(fd, owner, group)`
- `fchownat(dirfd, pathname, owner, group, flags)`
	- `flags`가 `AT_SYMLINK_NOFOLLOW`라면 `lchown` 처럼 링크자체에 적용
## 접근 가능성 검사 (`access()`)
- `access(pathname, mode)`: 파일을 실제로 열지 않고, 호출 프로세스의 **RUID/RGID** 기준으로 접근 권한을 검사합니다.
- `faccessat(dirfd, pathname, mode, flags)`
	- `flags`
		- 0 -> RUID/RGID 기준
		- `AT_EACCESS` -> EUID/EGID 기준
- `open()`은 **EUID/EGID** 기준으로 권한을 검사하므로, SUID가 설정된 프로그램에서는 `access()`는 실패해도 `open()`은 성공할 수 있습니다.
- `mode`: `R_OK`, `W_OK`, `X_OK`, `F_OK`(파일 존재 여부 확인)
## Sticky bit
디렉터리에 설정하는 특수 권한 비트입니다 (예: `/tmp`).
- Sticky Bit가 설정된 디렉터리에서는 **파일의 소유자** 또는 **슈퍼유저**(root)만이 파일을 삭제할 수 있도록 제한합니다.